---
alwaysApply: true
---

# Соглашения по разработке

> **Основа:** Все принципы и архитектурные решения подробно описаны в [@vision.md](@vision.md)

## Главный принцип: KISS

- Простые и понятные решения
- Никакого оверинжиниринга
- MVP-подход: сначала работающий код, потом оптимизация

## Архитектура

**Монолитная структура** с четким разделением слоев:

```
Handlers → Services → Requests → Database
```

- **Handlers** (`bot/handlers/`) - только обработка Telegram команд
- **Services** (`bot/services/`) - вся бизнес-логика
- **Requests** (`bot/requests/`) - все запросы к БД
- **Schemas** (`bot/@schemas/`) - Pydantic модели

## Технический стек

- **Python 3.11+**
- **aiogram 3.x** для Telegram бота
- **PostgreSQL** + **SQLAlchemy** (асинхронно)
- **Redis** для кэширования и сессий
- **Pydantic** для валидации данных

## Правила кода

### Структура файлов

- Один файл = одна ответственность
- Именование файлов: `snake_case`
- Классы: `PascalCase`
- Функции/переменные: `snake_case`

### База данных

- Все запросы к БД только через слой `requests/`
- Используй SQLAlchemy модели из `database/models.py`
- Асинхронные операции с БД

### API и внешние сервисы

- LLM запросы через ProxyAPI (не прямой OpenAI)
- Конфигурация через `.env` + Pydantic Settings
- Простая обработка ошибок: try/except + retry (1-2 попытки)

### Логирование

- Стандартный Python logging
- Логируй: действия пользователей, LLM запросы, ошибки
- Формат: `время - уровень - модуль - сообщение`

## Подход к разработке

1. **Feature-first** - от функциональности к коду
2. **Быстрые итерации** - тестируй на реальных пользователях
3. **Готовые решения** - используй где возможно
4. **Минимум абстракций** - простые прямолинейные решения

## Что НЕ делать

- ❌ Микросервисы
- ❌ Сложные паттерны и абстракции
- ❌ Преждевременная оптимизация
- ❌ Избыточная документация
- ❌ Сложные конфигурации (только .env)
